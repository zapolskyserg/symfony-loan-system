# Система Видачі Кредитів

Цей проєкт є реалізацією базової системи для видачі кредитів, розробленої на фреймворку **Symfony 7**. Основний акцент зроблено на демонстрації принципів проєктування програмного забезпечення, таких як **Clean Architecture**, **Domain-Driven Design (DDD)** та **SOLID**.

---

## Архітектура

Проєкт побудований за принципами "Чистої Архітектури" і має чіткий поділ на шари:

-   **Domain:** Ядро системи, що містить всю бізнес-логіку, сутності та правила. Не залежить від фреймворків та інфраструктури.
-   **Application:** Шар, що оркеструє бізнес-логіку та реалізує сценарії використання (Use Cases).
-   **Infrastructure:** Реалізація технічних деталей — доступ до даних (файли), відправка сповіщень (логер) тощо.
-   **Presentation:** Точки входу в додаток (REST API контролери).

---

## Функціонал та Бізнес-логіка

Система реалізує три основні сценарії, передбачені завданням.

### Реалізований функціонал

1.  ✅ **Створення нового клієнта:** Система дозволяє створювати нових клієнтів через API. Дані зберігаються у файловому сховищі, що дозволяє легко додавати тестових користувачів.

2.  ✅ **Перевірка можливості видачі кредиту:** Це ключовий функціонал. Система не просто дає відповідь "так/ні", а працює як **"фабрика пропозицій"**, генеруючи персоналізований список доступних кредитів для клієнта.

3.  ✅ **Видача кредиту:** Після вибору пропозиції система імітує видачу кредиту, надсилаючи клієнту **сповіщення-заглушку** у вигляді запису в лог-файл.

### Як працює "Фабрика кредитних пропозицій"?

Процес перевірки клієнта та формування пропозицій проходить у кілька етапів:

1.  **Жорсткі правила (Hard Rules):** Спочатку клієнт проходить через набір базових правил. Якщо хоча б одне з них не виконується, процес зупиняється, і клієнт отримує відмову.
2.  **Підбір продуктів:** Якщо базові перевірки пройдено, система знаходить усі кредитні продукти, що відповідають **кредитному рейтингу (Score)** клієнта.
3.  **Модифікатори (Soft Rules):** До списку підходящих продуктів застосовується набір модифікаторів, які коригують умови або можуть призвести до відмови на основі спеціальних правил.

### Умови видачі кредиту

#### Базові умови ("Жорсткі" правила)

-   **Вік:** від **18** до **60** років.
-   **Дохід:** не менше **$1000** на місяць.
-   **Регіон:** клієнт має бути з одного з обслуговуваних регіонів: **Прага (PR), Брно (BR), Острава (OS)**.

#### Спеціальні умови (Модифікатори)

-   **Кредитна історія (наше доопрацювання):**
    -   `GOOD`: Сума по всім пропозиціям **збільшується на 5%**.
    -   `BAD`: Сума **зменшується на 10%**, а ставка **збільшується на 0.5** процентних пункти.
    -   `BAD` + високий рейтинг (\>750): Ставка **додатково збільшується на 0.5** (разом на 1.0%).
-   **Регіональні правила:**
    -   **Прага (PR):** Існує **випадкова відмова** з імовірністю 50%.
    -   **Острава (OS):** Відсоткова ставка по всім пропозиціям **збільшується на 5** процентних пунктів (наприклад, з 10% до 15%).

### Масштабованість системи

Архітектура спроєктована з урахуванням легкого розширення:

-   **Додавання Кредитних Продуктів:** Щоб додати новий кредитний продукт, достатньо додати новий об'єкт у файл `var/data/loan_products.json`. **Зміни в коді не потрібні.**
-   **Додавання Клієнтів:** Нових клієнтів можна додавати або через API, або вручну у файл `var/data/clients.json` для тестування.
-   **Додавання Нових Правил:** Щоб додати нове правило перевірки (наприклад, перевірку статусу працевлаштування), достатньо створити один новий PHP-клас. Система автоматично "підхопить" його і почне використовувати без змін в існуючій логіці.

---

## Вимоги

-   Docker
-   Docker Compose

---

## Встановлення та запуск

1.  **Клонуйте репозиторій:**

    ```bash
    git clone <адреса_вашого_репозиторію>
    cd loan-system
    ```

2.  **Зберіть та запустіть Docker-контейнери:**

    ```bash
    docker-compose up -d --build
    ```

3.  **Встановіть залежності проєкту:**

    ```bash
    docker-compose exec php composer install
    ```

4.  **Запустіть вбудований веб-сервер:**

    ```bash
    docker-compose exec php php -S 0.0.0.0:8000 -t public
    ```

    Після цього ваш додаток буде доступний за адресою `http://localhost:8000`.

---

## Документація API

Додаток надає три основних ендпоінти.

### 1\. Створення нового клієнта

Створює нового клієнта у системі. Дані зберігаються у файлі `var/data/clients.json`.

-   **Method:** `POST`
-   **URL:** `/api/clients`
-   **Body (raw, JSON):**
    ```json
    {
        "name": "Maria Curie",
        "age": 42,
        "regionCode": "PR",
        "income": 3500,
        "score": 850,
        "creditHistoryStatus": "good",
        "pin": "987-65-4321",
        "email": "maria.curie@example.com",
        "phone": "+420999888777"
    }
    ```
-   **Приклад cURL:**
    ```bash
    curl -X POST http://localhost:8000/api/clients \
    -H "Content-Type: application/json" \
    -d '{"name": "Maria Curie", "age": 42, "regionCode": "PR", "income": 3500, "score": 850, "creditHistoryStatus": "good", "pin": "987-65-4321", "email": "maria.curie@example.com", "phone": "+420999888777"}'
    ```
-   **Успішна відповідь:** `Status: 201 Created`
-   **Відповідь у разі помилки (неправильний регіон):** `Status: 400 Bad Request`
    ```json
    {
        "error": "Region code <XY> is not allowed."
    }
    ```

### 2\. Отримання кредитних пропозицій для клієнта

Перевіряє клієнта за всіма бізнес-правилами та повертає список персоналізованих кредитних пропозицій.

-   **Method:** `GET`
-   **URL:** `/api/clients/{clientId}/loan-offers`
-   **Приклад cURL (для клієнта Anna Novakova):**
    ```bash
    curl http://localhost:8000/api/clients/d290f1ee-6c54-4b01-90e6-d701748f0852/loan-offers
    ```
-   **Успішна відповідь:** `Status: 200 OK`
    ```json
    [
        {
            "productName": "Standard Loan",
            "amount": 5000,
            "rate": 15
        }
    ]
    ```
-   **Відповідь у разі відмови:** `Status: 403 Forbidden`
    ```json
    {
        "message": "Client age is not within the allowed range (18-60)."
    }
    ```

### 3\. Видача кредиту

Імітує видачу кредиту та надсилає сповіщення клієнту (записує його в лог).

-   **Method:** `POST`
-   **URL:** `/api/loans/issue`
-   **Body (raw, JSON):**
    ```json
    {
        "clientId": "d290f1ee-6c54-4b01-90e6-d701748f0852",
        "productName": "Standard Loan",
        "amount": 5000,
        "rate": 15.0
    }
    ```
-   **Приклад cURL:**
    ```bash
    curl -X POST http://localhost:8000/api/loans/issue \
    -H "Content-Type: application/json" \
    -d '{"clientId": "d290f1ee-6c54-4b01-90e6-d701748f0852", "productName": "Standard Loan", "amount": 5000, "rate": 15.0}'
    ```
-   **Успішна відповідь:** `Status: 200 OK`
    ```json
    {
        "status": "success",
        "message": "Loan issued and notification queued."
    }
    ```
-   **Результат:** У файлі `var/log/dev.log` з'явиться новий запис про сповіщення.

---

## Сховище Даних

Проєкт використовує файли для зберігання даних, як і було дозволено у завданні. Ви можете редагувати їх для тестування різних сценаріїв:

-   **Клієнти:** `var/data/clients.json`
-   **Кредитні продукти:** `var/data/loan_products.json`
